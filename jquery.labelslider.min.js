/*
* LabelSlider 1.0
*
* Copyright 2014, Corey Meredith - http://halfduplex.us/
* Released under the GNU GENERAL PUBLIC LICENSE - http://www.gnu.org/licenses/gpl-3.0.txt
*
*/

(function(e){"use strict";e.fn.labelSlider=function(t){function u(e){var t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!t)return 0;return Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0))}var n={initValue:true,pixelsPerUnit:1,triggerChangeOnStop:false,validate:true};if(t)e.extend(n,t);if(!e.isNumeric(n.pixelsPerUnit)||n.pixelsPerUnit<.01)n.pixelsPerUnit=1;var r="INPUT:not([type]), INPUT[type=text], INPUT[type=number], INPUT[type=range], INPUT[type=slider], INPUT[type=search], INPUT[type=hidden], INPUT[type=date], METER, PROGRESS",i={cursor:"e-resize","user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-webkit-user-select":"none"},s="";for(var o in i){s+=o+": "+i[o]+"; "}this.each(function(){function a(e,t){if(e.data("ls_isdate")){t=t?t:isNaN(Date.parse(e.val()))?Date.now():e[0].valueAsNumber;if(e.data("ls_hasMin")){var n=e.data("ls_min");if(t<n)t=n}if(e.data("ls_hasMax")){var r=e.data("ls_max");if(t>r)t=r}e[0].valueAsNumber=t}else{t=t?t:parseFloat(e.val());if(isNaN(t))t=0;if(e.data("ls_hasMin")){var n=parseFloat(e.attr("min"));if(t<n)t=n}if(e.data("ls_hasMax")){var r=parseFloat(e.attr("max"));if(t>r)t=r}e.val(t)}}var t=e(this),o=[];if(t.attr("for"))o=e("#"+t.attr("for"));if(!o.length)o=t.find(r).first();if(!o.length||!o.is(r)||t.data("labelSliderInstrumented")||o.is("INPUT[type=date]")&&typeof o[0].valueAsNumber==="undefined")return;t.data("labelSliderInstrumented",true);t.data("ls_input",o);t.css(i);if(o.is("PROGRESS"))o.attr("min","0");o.data("ls_isdate",o.is("INPUT[type=date]"));if(o.data("ls_isdate")){o.data("ls_hasMin",!isNaN(Date.parse(o.attr("min"))));o.data("ls_hasMax",!isNaN(Date.parse(o.attr("max"))));if(o.data("ls_hasMin"))o.data("ls_min",Date.parse(o.attr("min")));if(o.data("ls_hasMax"))o.data("ls_max",Date.parse(o.attr("max")));o.data("ls_step",e.isNumeric(o.attr("step"))?parseInt(o.attr("step")):1)}else{o.data("ls_hasMin",e.isNumeric(o.attr("min")));o.data("ls_hasMax",e.isNumeric(o.attr("max")));o.data("ls_step",e.isNumeric(o.attr("step"))?parseFloat(o.attr("step")):1);o.data("ls_stepPrecision",u(o.data("ls_step")))}if(n.initValue)a(o);if(n.validate){if(!o.data("ls_isdate")){o.keydown(function(e){var t=e.keyCode;if(!(t>=48&&t<=57||t>=96&&t<=105||t>=35&&t<=40||t==8||t==9||t==13||t==27||t==45||t==46||t==189||t==190||(t==65||t==67||t==86||t==88)&&e.ctrlKey===true))e.preventDefault()}).bind("drop",function(e){if(isNaN(parseFloat(e.originalEvent.dataTransfer.getData("Text"))))e.preventDefault();else setTimeout(function(){o.trigger("change")},0)})}o.change(function(t){a(e(t.target))}).blur(function(t){e(t.target).trigger("change")})}t.draggable({revert:true,revertDuration:0,helper:function(){return'<span style="'+s+"background: #FFF; "+"display: inline-block; "+"filter: alpha(opacity=0); "+"height: 30px; "+"opacity: 0; "+"width: 60px;"+'"></span>'},cursor:"e-resize",cursorAt:{top:15,left:30},start:function(t,n){e(this).data("ls_input").addClass("label-slider-sliding")},drag:function(t,r){var i=e(this),s=Math.round(r.position.left);if(typeof i.data("ls_lastLeft")==="undefined")i.data("ls_lastLeft",s);var o=i.data("ls_lastLeft"),f=s-o;if(Math.abs(f)<n.pixelsPerUnit)return;var l=i.data("ls_input"),c=n.pixelsPerUnit<1?Math.round(f/n.pixelsPerUnit):Math.floor(f/n.pixelsPerUnit);if(l.data("ls_isdate")){var h=isNaN(Date.parse(l.val()))?Date.now():l[0].valueAsNumber,p=l.data("ls_step")*864e5,d=parseInt(h+p*c)}else{var h=e.isNumeric(l.val())?parseFloat(l.val()):0,p=l.data("ls_step"),v=l.data("ls_stepPrecision"),m=u(h),g=v>m?v:m,d=parseFloat((h+p*c).toFixed(g))}i.data("ls_lastLeft",s);a(l,d);if(!n.triggerChangeOnStop)l.trigger("change")},stop:function(){var t=e(this),r=t.data("ls_input");r.removeClass("label-slider-sliding");t.removeData("ls_lastLeft");if(n.triggerChangeOnStop)r.trigger("change")}})});return this};e(function(){e(".label-slider").labelSlider()})})(jQuery)